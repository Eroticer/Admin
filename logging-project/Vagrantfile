Vagrant.configure("2") do |config|
  config.vm.box = "rockylinux/9"
  
  # Web server
  config.vm.define "web" do |web|
    web.vm.hostname = "web"
    web.vm.network "private_network", ip: "192.168.56.10"
    web.vm.provider "libvirt" do |lv|
      lv.memory = 1024
      lv.cpus = 1
    end
    web.vm.provision "ansible" do |ansible|
      ansible.playbook = "provisioning/site.yml"
      ansible.become = true
      ansible.become_user = "root"
      ansible.groups = {
        "web_servers" => ["web"],
        "rsyslog_clients" => ["web"]
      }
    end
  end

  # Log server (rsyslog)
  config.vm.define "log" do |log|
    log.vm.hostname = "log"
    log.vm.network "private_network", ip: "192.168.56.20"
    log.vm.provider "libvirt" do |lv|
      lv.memory = 1024
      lv.cpus = 1
    end
    log.vm.provision "ansible" do |ansible|
      ansible.playbook = "provisioning/site.yml"
      ansible.become = true
      ansible.become_user = "root"
      ansible.groups = {
        "rsyslog_servers" => ["log"]
      }
    end
  end

  # ELK server (опционально)
  config.vm.define "elk" do |elk|
    elk.vm.hostname = "elk"
    elk.vm.network "private_network", ip: "192.168.56.30"
    elk.vm.provider "libvirt" do |lv|
      lv.memory = 4096
      lv.cpus = 2
    end
    elk.vm.provision "ansible" do |ansible|
      ansible.playbook = "provisioning/site.yml"
      ansible.become = true
      ansible.become_user = "root"
      ansible.groups = {
        "elk_servers" => ["elk"]
      }
    end
  end
end
