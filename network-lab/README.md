# Сетевая лаборатория на Libvirt/KVM с Rocky Linux 9

## Описание
Сложная сетевая лаборатория с маршрутизацией и NAT, развернутая на базе Libvirt/KVM с Rocky Linux 9.

## Архитектура сети
- **inetRouter** - шлюз в интернет с NAT
- **centralRouter** - центральный маршрутизатор  
- **office1Router**, **office2Router** - маршрутизаторы офисов
- **centralServer**, **office1Server**, **office2Server** - серверы в соответствующих сетях

## Теоретическая часть - Расчет подсетей

### Исходные сети:

**Central Network: 192.168.0.0/24**
- 192.168.0.0/28     - directors
- 192.168.0.32/28    - office hardware  
- 192.168.0.64/26    - wifi

**Office1 Network: 192.168.2.0/24**
- 192.168.2.0/26     - dev
- 192.168.2.64/26    - test servers
- 192.168.2.128/26   - managers
- 192.168.2.192/26   - office hardware

**Office2 Network: 192.168.1.0/24**
- 192.168.1.0/25     - dev
- 192.168.1.128/26   - test servers
- 192.168.1.192/26   - office hardware

**Router Networks: 192.168.255.0/24**
- 192.168.255.0/30   - inet-central
- 192.168.255.8/30   - office1-central
- 192.168.255.4/30   - office2-central

### Расчет подсетей:

| Сеть | Маска | Кол-во узлов | Первый IP | Последний IP | Broadcast | Статус |
|------|-------|--------------|-----------|--------------|-----------|---------|
| **Central Network** | | | | | | |
| 192.168.0.0 | /28 | 14 | 192.168.0.1 | 192.168.0.14 | 192.168.0.15 | directors |
| 192.168.0.16 | /28 | 14 | 192.168.0.17 | 192.168.0.30 | 192.168.0.31 | свободно |
| 192.168.0.32 | /28 | 14 | 192.168.0.33 | 192.168.0.46 | 192.168.0.47 | office hardware |
| 192.168.0.48 | /28 | 14 | 192.168.0.49 | 192.168.0.62 | 192.168.0.63 | свободно |
| 192.168.0.64 | /26 | 62 | 192.168.0.65 | 192.168.0.126 | 192.168.0.127 | wifi |
| 192.168.0.128 | /25 | 126 | 192.168.0.129 | 192.168.0.254 | 192.168.0.255 | свободно |

| **Office1 Network** | | | | | | |
| 192.168.2.0 | /26 | 62 | 192.168.2.1 | 192.168.2.62 | 192.168.2.63 | dev |
| 192.168.2.64 | /26 | 62 | 192.168.2.65 | 192.168.2.126 | 192.168.2.127 | test servers |
| 192.168.2.128 | /26 | 62 | 192.168.2.129 | 192.168.2.190 | 192.168.2.191 | managers |
| 192.168.2.192 | /26 | 62 | 192.168.2.193 | 192.168.2.254 | 192.168.2.255 | office hardware |

| **Office2 Network** | | | | | | |
| 192.168.1.0 | /25 | 126 | 192.168.1.1 | 192.168.1.126 | 192.168.1.127 | dev |
| 192.168.1.128 | /26 | 62 | 192.168.1.129 | 192.168.1.190 | 192.168.1.191 | test servers |
| 192.168.1.192 | /26 | 62 | 192.168.1.193 | 192.168.1.254 | 192.168.1.255 | office hardware |

| **Router Networks** | | | | | | |
| 192.168.255.0 | /30 | 2 | 192.168.255.1 | 192.168.255.2 | 192.168.255.3 | inet-central |
| 192.168.255.4 | /30 | 2 | 192.168.255.5 | 192.168.255.6 | 192.168.255.7 | office2-central |
| 192.168.255.8 | /30 | 2 | 192.168.255.9 | 192.168.255.10 | 192.168.255.11 | office1-central |
| 192.168.255.12 | /30 | 2 | 192.168.255.13 | 192.168.255.14 | 192.168.255.15 | свободно |
| 192.168.255.16 | /28 | 14 | 192.168.255.17 | 192.168.255.30 | 192.168.255.31 | свободно |
| 192.168.255.32 | /27 | 30 | 192.168.255.33 | 192.168.255.62 | 192.168.255.63 | свободно |
| 192.168.255.64 | /26 | 62 | 192.168.255.65 | 192.168.255.126 | 192.168.255.127 | свободно |
| 192.168.255.128 | /25 | 126 | 192.168.255.129 | 192.168.255.254 | 192.168.255.255 | свободно |

| **Management Network** | | | | | | |
| 192.168.50.0 | /24 | 254 | 192.168.50.1 | 192.168.50.254 | 192.168.50.255 | management |

### Итоговые подсчеты:

**Всего узлов в используемых сетях:**
- Central Network: 14 + 14 + 62 = 90 узлов
- Office1 Network: 62 + 62 + 62 + 62 = 248 узлов  
- Office2 Network: 126 + 62 + 62 = 250 узлов
- Router Networks: 2 + 2 + 2 = 6 узлов
- Management: 254 узлов
- **Итого используемых: 848 узлов**

**Свободные узлы:**
- Central Network: 14 + 14 + 126 = 154 узла
- Router Networks: 2 + 14 + 30 + 62 + 126 = 234 узла
- **Итого свободных: 388 узлов**

**Общее количество узлов во всех сетях: 1236 узлов**

### Проверка разбиения:

Разбиение выполнено корректно, без перекрытий подсетей. Все подсети принадлежат частным адресным пространствам:
- 192.168.0.0/16 - Private network (RFC 1918)

Свободные подсети могут быть использованы для будущего расширения сети.
## Дополнительная документация

- [Детальные расчеты сетей](network-calculations.md) - подробные вычисления подсетей, broadcast адресов и проверка разбиения


### Предварительные требования
```bash
# Установка необходимых пакетов
sudo apt update
sudo apt install -y vagrant libvirt-daemon-system libvirt-clients \
    qemu-kvm qemu-utils bridge-utils virt-manager \
    ansible

# Установка плагина vagrant-libvirt
vagrant plugin install vagrant-libvirt




./create-networks.sh

# Запустить машины
vagrant up --provider=libvirt

# Настроить сеть
./setup-rocky-network.sh
./fix-routes.sh
./enable-forwarding.sh
./setup-nat.sh

# Протестировать
./final-test.sh
