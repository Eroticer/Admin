# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
  config.vm.synced_folder ".", "/vagrant", type: "rsync"
  
  # Провайдер libvirt - МИНИМАЛЬНЫЕ НАСТРОЙКИ
  config.vm.provider :libvirt do |libvirt|
    libvirt.driver = "kvm"
    libvirt.memory = 1024
    libvirt.cpus = 1
    # Убираем ВСЕ дополнительные настройки которые вызывают ошибки
  end

  # inetRouter
  config.vm.define "inetRouter" do |node|
    node.vm.box = "rockylinux/9"
    node.vm.hostname = "inetRouter"
    
    node.vm.network "private_network",
      ip: "192.168.255.1",
      netmask: "255.255.255.252",
      libvirt__network_name: "router-net"

    node.vm.network "private_network",
      ip: "192.168.50.10",
      netmask: "255.255.255.0", 
      libvirt__network_name: "management"
  end

  # centralRouter
  config.vm.define "centralRouter" do |node|
    node.vm.box = "rockylinux/9"
    node.vm.hostname = "centralRouter"
    
    node.vm.network "private_network",
      ip: "192.168.255.2",
      netmask: "255.255.255.252",
      libvirt__network_name: "router-net"

    node.vm.network "private_network",
      ip: "192.168.0.1",
      netmask: "255.255.255.240",
      libvirt__network_name: "dir-net"

    node.vm.network "private_network",
      ip: "192.168.255.9",
      netmask: "255.255.255.252",
      libvirt__network_name: "office1-central"

    node.vm.network "private_network",
      ip: "192.168.255.5",
      netmask: "255.255.255.252",
      libvirt__network_name: "office2-central"

    node.vm.network "private_network",
      ip: "192.168.50.11",
      netmask: "255.255.255.0",
      libvirt__network_name: "management"
  end

  # centralServer
  config.vm.define "centralServer" do |node|
    node.vm.box = "rockylinux/9"
    node.vm.hostname = "centralServer"
    
    node.vm.network "private_network",
      ip: "192.168.0.2",
      netmask: "255.255.255.240",
      libvirt__network_name: "dir-net"

    node.vm.network "private_network",
      ip: "192.168.50.12",
      netmask: "255.255.255.0",
      libvirt__network_name: "management"
  end

  # office1Router
  config.vm.define "office1Router" do |node|
    node.vm.box = "rockylinux/9"
    node.vm.hostname = "office1Router"
    
    node.vm.network "private_network",
      ip: "192.168.255.10",
      netmask: "255.255.255.252",
      libvirt__network_name: "office1-central"

    node.vm.network "private_network",
      ip: "192.168.2.1",
      netmask: "255.255.255.192",
      libvirt__network_name: "dev1-net"

    node.vm.network "private_network",
      ip: "192.168.50.20",
      netmask: "255.255.255.0",
      libvirt__network_name: "management"
  end

  # office1Server
  config.vm.define "office1Server" do |node|
    node.vm.box = "rockylinux/9"
    node.vm.hostname = "office1Server"
    
    node.vm.network "private_network",
      ip: "192.168.2.130",
      netmask: "255.255.255.192",
      libvirt__network_name: "managers-net"

    node.vm.network "private_network",
      ip: "192.168.50.21",
      netmask: "255.255.255.0",
      libvirt__network_name: "management"
  end

  # office2Router
  config.vm.define "office2Router" do |node|
    node.vm.box = "rockylinux/9"
    node.vm.hostname = "office2Router"
    
    node.vm.network "private_network",
      ip: "192.168.255.6",
      netmask: "255.255.255.252",
      libvirt__network_name: "office2-central"

    node.vm.network "private_network",
      ip: "192.168.1.1",
      netmask: "255.255.255.128",
      libvirt__network_name: "dev2-net"

    node.vm.network "private_network",
      ip: "192.168.50.30",
      netmask: "255.255.255.0",
      libvirt__network_name: "management"
  end

  # office2Server
  config.vm.define "office2Server" do |node|
    node.vm.box = "rockylinux/9"
    node.vm.hostname = "office2Server"
    
    node.vm.network "private_network",
      ip: "192.168.1.2",
      netmask: "255.255.255.128",
      libvirt__network_name: "dev2-net"

    node.vm.network "private_network",
      ip: "192.168.50.31",
      netmask: "255.255.255.0",
      libvirt__network_name: "management"
  end
end
